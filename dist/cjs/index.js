"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const K=require("./utilities/diff.js"),p=require("./utilities/extractor.js"),b=require("./utilities/kanaConverter.js");var H=(c=>(c[c.REALTIME=0]="REALTIME",c[c.ENTER=1]="ENTER",c))(H||{});function O(c,y,n={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:p.CaptureableCharacterType.HIRAGANA}){const I=p.generateCaptureableRegExp(n.captureablePatterns??p.CaptureableCharacterType.HIRAGANA),a=typeof c=="string"?document.querySelector(c):c;if(!a)throw new Error("input element not found");let E=0;const _=!(n.realtime instanceof HTMLInputElement)&&!(n.enter instanceof HTMLInputElement);function M(){const e=n.realtime&&(n.realtime===!0||n.realtime instanceof HTMLInputElement&&n.realtime.checked),t=n.enter&&(n.enter===!0||n.enter instanceof HTMLInputElement&&n.enter.checked);E=e||!t?0:1}const u=[],A=e=>{if(typeof e=="string"){const t=document.querySelectorAll(e);for(const d of t)u.push({element:d,type:b.KanaType.Hiragana})}else e instanceof HTMLInputElement?u.push({element:e,type:b.KanaType.Hiragana}):u.push({element:e.element,type:e.type??b.KanaType.Hiragana})};if(Array.isArray(y))for(const e of y)A(e);else A(y);let i=!1,s="",v="",o="";const l=new Array(u.length).fill("");function L(){r("reset"),s="",v="",o="";for(let e=0;e<u.length;e++)l[e]=""}function g(){s=a.value,u.forEach(({element:e},t)=>{l[t]=e.value}),r("setup",a.value,{defaultString:s,activeOutputs:u})}let f;function R(){r("start",{timer:f}),!f&&(f=setInterval(()=>{_||M(),S()},n.observeInterval??30))}function C(){r("end",{timer:f}),f&&(clearInterval(f),f=void 0)}function S(){const e=a.value;if(r("observe",{observing:i,inputString:e,defaultString:s,currentString:v,outputValues:l}),e==="")return;const t=K.diff(s,e);v!==t.diff&&(v=t.diff,i&&m(v))}function m(e){r("set",{defaultString:s,string:e,inputValue:o,outputValues:l});const t=p.extractor({input:e,patterns:I});t.length===e.length&&(o=t),u.forEach(({element:d,type:k},T)=>{const h=b.kanaConverter(k,o);r("converted",{type:k,string:e,inputValue:o,after:h,before:l[T]}),E===0?d.value=l[T]+h:E===1&&(d.dataset.kana=l[T]=h)})}function q(){u.forEach(({element:e})=>{e.dataset.kana&&(e.value+=e.dataset.kana,e.removeAttribute("data-kana"))})}function r(e,...t){if(n.debug){if(t.length===0){console.info("debug",{message:e});return}console.info("debug",{message:e},...t)}}a.addEventListener("focus",()=>{r("focus"),g()}),a.addEventListener("blur",()=>{r("blur"),C()}),a.addEventListener("compositionstart",e=>{r("compositionstart",{e}),g(),R(),i=!0}),a.addEventListener("compositionend",e=>{r("compositionend",{e}),C(),m(o),L(),i=!1}),a.addEventListener("beforeinput",e=>{if(r("beforeinput",{observing:i,e}),!i&&!e.isComposing&&e.data){const t=e.data,d=p.extractor({input:t,patterns:I});t&&t===d&&(g(),m(t))}}),a.addEventListener("keyup",e=>{r("keyup",{observing:i,e}),e.code==="Enter"&&(n.clearOnInputEmpty&&a.value===""?(L(),m("")):E===1&&q())})}exports.CaptureableCharacterType=p.CaptureableCharacterType;exports.KanaType=b.KanaType;exports.OutputTiming=H;exports.setupObserver=O;
//# sourceMappingURL=index.js.map

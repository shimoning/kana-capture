"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("./utilities/kanaConverter.js");var h=(t=>(t[t.REALTIME=0]="REALTIME",t[t.ENTER=1]="ENTER",t))(h||{});const T=/[^ 　ぁあ-んー]/g,C=/[ぁぃぅぇぉっゃゅょ]/g;function O(t,g,a={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1}){let v=0;function I(){const e=a.realtime&&(a.realtime===!0||a.realtime instanceof HTMLInputElement&&a.realtime.checked),n=a.enter&&(a.enter===!0||a.enter instanceof HTMLInputElement&&a.enter.checked);v=e||!n?0:1}const l=[];if(typeof g=="string"){const e=document.querySelectorAll(g);for(const n of e)l.push({element:n,type:i.KanaType.Hiragana})}else for(const e of g)if(typeof e=="string"){const n=document.querySelectorAll(e);for(const m of n)l.push({element:m,type:i.KanaType.Hiragana})}else l.push({element:e.element,type:e.type??i.KanaType.Hiragana});let o=!1,c="",s="",d="";const f=new Array(l.length).fill("");function L(){r("reset"),c="",s="",d="";for(let e=0;e<l.length;e++)f[e]=""}function E(){c=t.value,l.forEach(({element:e},n)=>{f[n]=e.value}),r("setup",t.value,{defaultString:c,activeOutputs:l})}let u;function H(){r("start",{timer:u}),!u&&(u=setInterval(()=>{I(),_()},a.observeInterval??30))}function b(){r("end"),u&&(clearInterval(u),u=void 0)}function _(){let e=t.value;if(r("observe",{compositing:o,inputString:e,defaultString:c,currentString:s,outputValues:f}),e===""||(e.indexOf(c)!==-1&&(e=e.replace(c,"")),s===e)||(s=e,!o))return;const n=s.replace(T,"");k(n)}function k(e){r("set",{defaultString:c,hiraganaString:e,inputValue:d,outputValues:f}),e.length&&(d=e),l.forEach(({element:n,type:m},y)=>{const p=i.kanaConverter(m,d);r("converted",{type:m,inputValue:d,after:p,before:f[y]}),v===0?n.value=f[y]+p:v===1&&(n.dataset.kana=f[y]=p)})}function A(){l.forEach(({element:e})=>{e.dataset.kana&&(e.value+=e.dataset.kana,e.removeAttribute("data-kana"))})}function r(e,...n){if(a.debug){if(n.length===0){console.info("debug",{message:e});return}console.info("debug",{message:e},...n)}}t.addEventListener("focus",()=>{r("focus"),E()}),t.addEventListener("blur",()=>{r("blur"),b()}),t.addEventListener("compositionstart",e=>{r("compositionstart",{e}),E(),H(),o=!0}),t.addEventListener("compositionend",e=>{r("compositionend",{e}),b(),o=!1}),t.addEventListener("keydown",e=>{r("keydown",{compositing:o,e}),o||E(),e.code==="Enter"&&(a.clearOnInputEmpty&&t.value===""?(L(),k("")):v===1&&A())}),t.addEventListener("keyup",e=>{r("keyup",{compositing:o,e})})}exports.KanaType=i.KanaType;exports.kanaConverter=i.kanaConverter;exports.AntiHiraganaPattern=T;exports.CompactHiraganaPattern=C;exports.OutputMode=h;exports.setupObserver=O;
//# sourceMappingURL=observer.js.map

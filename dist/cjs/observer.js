"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const y=require("./utilities/extractor.js"),d=require("./utilities/kanaConverter.js");var I=(t=>(t[t.REALTIME=0]="REALTIME",t[t.ENTER=1]="ENTER",t))(I||{});function R(t,b,n={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:y.CaptureableCharacterType.HIRAGANA}){let v=0;function C(){const e=n.realtime&&(n.realtime===!0||n.realtime instanceof HTMLInputElement&&n.realtime.checked),r=n.enter&&(n.enter===!0||n.enter instanceof HTMLInputElement&&n.enter.checked);v=e||!r?0:1}const l=[];if(typeof b=="string"){const e=document.querySelectorAll(b);for(const r of e)l.push({element:r,type:d.KanaType.Hiragana})}else for(const e of b)if(typeof e=="string"){const r=document.querySelectorAll(e);for(const p of r)l.push({element:p,type:d.KanaType.Hiragana})}else l.push({element:e.element,type:e.type??d.KanaType.Hiragana});let c=!1,u="",i="",o="";const f=new Array(l.length).fill("");function T(){a("reset"),u="",i="",o="";for(let e=0;e<l.length;e++)f[e]=""}function E(){u=t.value,l.forEach(({element:e},r)=>{f[r]=e.value}),a("setup",t.value,{defaultString:u,activeOutputs:l})}let s;function L(){a("start",{timer:s}),!s&&(s=setInterval(()=>{C(),_()},n.observeInterval??30))}function k(){a("end",{timer:s}),s&&(clearInterval(s),s=void 0)}function _(){let e=t.value;a("observe",{compositing:c,inputString:e,defaultString:u,currentString:i,outputValues:f}),e!==""&&(e=e.replace(new RegExp("["+u+"]","g"),""),i!==e&&(i=e,c&&m(i)))}function m(e){a("set",{defaultString:u,string:e,inputValue:o,outputValues:f});const r=y.extractor({input:e,patterns:n.captureablePatterns??y.CaptureableCharacterType.HIRAGANA});console.warn({extracted:r,string:e,inputValue:o,defaultString:u}),r.length===e.length&&(o=r),l.forEach(({element:p,type:A},h)=>{const g=d.kanaConverter(A,o);a("converted",{type:A,string:e,inputValue:o,after:g,before:f[h]}),v===0?p.value=f[h]+g:v===1&&(p.dataset.kana=f[h]=g)})}function H(){l.forEach(({element:e})=>{e.dataset.kana&&(e.value+=e.dataset.kana,e.removeAttribute("data-kana"))})}function a(e,...r){if(n.debug){if(r.length===0){console.info("debug",{message:e});return}console.info("debug",{message:e},...r)}}t.addEventListener("focus",()=>{a("focus"),E()}),t.addEventListener("blur",()=>{a("blur"),k()}),t.addEventListener("compositionstart",e=>{a("compositionstart",{e}),E(),L(),c=!0}),t.addEventListener("compositionend",e=>{a("compositionend",{e}),k(),m(o),T(),c=!1}),t.addEventListener("keydown",e=>{a("keydown",{compositing:c,e}),c||E(),e.code==="Enter"&&(n.clearOnInputEmpty&&t.value===""?(T(),m("")):v===1&&H())}),t.addEventListener("keyup",e=>{a("keyup",{compositing:c,e})})}exports.CaptureableCharacterType=y.CaptureableCharacterType;exports.KanaType=d.KanaType;exports.OutputMode=I;exports.setupObserver=R;
//# sourceMappingURL=observer.js.map

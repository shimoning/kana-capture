(function(l,H){typeof exports=="object"&&typeof module<"u"?H(exports):typeof define=="function"&&define.amd?define(["exports"],H):(l=typeof globalThis<"u"?globalThis:l||self,H(l.KanaCapture={}))})(this,function(l){"use strict";function H(e,r){if(!e.length||!r.length)return{before:e,after:r,diff:r,same:"",gap:0};if(e===r)return{before:e,after:r,diff:"",same:e,gap:0};const t=e.split(""),i=r.split(""),s=Math.max(t.length,i.length),c=[],h=[];let g=0;for(let A=0;A<s;A++){const K=t[A];for(let o=A+g;o<s;o++,g++){const U=i[o];if(K===U){c.push(K);break}h.push(U)}}return{before:e,after:r,diff:h.join(""),same:c.join(""),gap:g}}var k=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(k||{});const D={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂”＃＄％＆＇’（）＊＋，－．／：；＜＝＞？＠［￥］＾＿｀“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function b({input:e,patterns:r=0}){const t=r instanceof RegExp?r:B(r),i=e.replace(t,"");return i.length===0?e:e.replace(new RegExp("["+i+"]","g"),"")}function B(e){const r=[],t=i=>{typeof i=="string"?r.push("["+i+"]"):i instanceof RegExp?r.push(i.source):r.push(D[i].source)};if(Array.isArray(e))for(const i of e)t(i);else t(e);return new RegExp(r.join("|"),"g")}function T(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function V(e){return e+96}const R={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"},P={Ａ:"A",Ｂ:"B",Ｃ:"C",Ｄ:"D",Ｅ:"E",Ｆ:"F",Ｇ:"G",Ｈ:"H",Ｉ:"I",Ｊ:"J",Ｋ:"K",Ｌ:"L",Ｍ:"M",Ｎ:"N",Ｏ:"O",Ｐ:"P",Ｑ:"Q",Ｒ:"R",Ｓ:"S",Ｔ:"T",Ｕ:"U",Ｖ:"V",Ｗ:"W",Ｘ:"X",Ｙ:"Y",Ｚ:"Z",ａ:"a",ｂ:"b",ｃ:"c",ｄ:"d",ｅ:"e",ｆ:"f",ｇ:"g",ｈ:"h",ｉ:"i",ｊ:"j",ｋ:"k",ｌ:"l",ｍ:"m",ｎ:"n",ｏ:"o",ｐ:"p",ｑ:"q",ｒ:"r",ｓ:"s",ｔ:"t",ｕ:"u",ｖ:"v",ｗ:"w",ｘ:"x",ｙ:"y",ｚ:"z"},Z={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"},x={"　":" ","！":"!","＂":'"',"”":'"',"＃":"#","＄":"$","％":"%","＆":"&","＇":"'","’":"'","（":"(","）":")","＊":"*","＋":"+","，":",","－":"-","．":".","／":"/","：":":","；":";","＜":"<","＝":"=","＞":">","？":"?","＠":"@","［":"[","￥":"\\","］":"]","＾":"^","＿":"_","｀":"`","“":"`","｛":"{","｜":"|","｝":"}","～":"~"};var N=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(N||{});function z(e,r){let t="";for(let i=0;i<r.length;i++){const s=r[i];if(e===0)t+=s;else if(e===1){const c=r.charCodeAt(i);T(c)?t+=String.fromCharCode(V(c)):t+=s}else e===2&&(typeof R[s]=="string"?t+=R[s]:typeof P[s]=="string"?t+=P[s]:typeof Z[s]=="string"?t+=Z[s]:typeof x[s]=="string"?t+=x[s]:t+=s)}return t}var Y=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(Y||{});function $(e,r,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:k.HIRAGANA}){const i=B(t.captureablePatterns??k.HIRAGANA),s=typeof e=="string"?document.querySelector(e):e;if(!s)throw new Error("input element not found");let c=0;const h=t.realtime instanceof HTMLInputElement,g=t.enter instanceof HTMLInputElement,A=!h&&!g;function K(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),f=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);c=n||!f?0:1}A&&K(),a("outputTiming",{outputTiming:c,outputTimingIsStatic:A,realtimeIsDynamic:h,enterIsDynamic:g});const o=[],U=n=>{if(typeof n=="string"){const f=document.querySelectorAll(n);for(const u of f)o.push({element:u,type:N.Hiragana})}else n instanceof HTMLInputElement?o.push({element:n,type:N.Hiragana}):o.push({element:n.element,type:n.type??N.Hiragana})};if(Array.isArray(r))for(const n of r)U(n);else U(r);let d=!1,m="",L="",v="";const _=new Array(o.length).fill("");function j(){a("reset"),m="",L="",v="";for(let n=0;n<o.length;n++)_[n]=""}function M(){m=s.value,o.forEach(({element:n},f)=>{_[f]=n.value}),a("setup",s.value,{defaultString:m,activeOutputs:o})}let E;function y(){a("start",{timer:E}),!E&&(E=setInterval(()=>{F()},t.observeInterval??30))}function G(){a("end",{timer:E}),E&&(clearInterval(E),E=void 0)}function F(){const n=s.value;if(a("observe",{observing:d,inputString:n,defaultString:m,currentString:L,outputValues:_}),n==="")return;const f=H(m,n);L!==f.diff&&(L=f.diff,d&&I(L))}function I(n){a("set",{defaultString:m,string:n,inputValue:v,outputValues:_});const f=b({input:n,patterns:i});f.length===n.length&&(v=f),o.forEach(({element:u,type:p},q)=>{const O=z(p,v);a("converted",{type:p,string:n,inputValue:v,after:O,before:_[q],bufferKana:u.dataset.bufferKana,bufferOther:u.dataset.bufferOther}),c===0?u.value=_[q]+O:c===1&&J(u,O)})}function J(n,f){d?n.dataset.bufferKana=f:n.dataset.bufferOther=(n.dataset.bufferOther??"")+f}function S(n){console.log("clear buffer"),n.dataset.bufferOther="",n.dataset.bufferKana=""}function w(n=!1){o.forEach(({element:f})=>{if(n){f.value="",S(f);return}const u=(f.dataset.bufferOther??"")+(f.dataset.bufferKana??"");u&&(f.value+=u,S(f))})}function a(n,...f){if(t.debug){if(f.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...f)}}s.addEventListener("focus",()=>{a("focus"),M()}),s.addEventListener("blur",()=>{a("blur"),G()}),s.addEventListener("compositionstart",n=>{a("compositionstart",{e:n}),M(),y(),d=!0}),s.addEventListener("compositionend",n=>{a("compositionend",{e:n}),G(),I(v),j(),d=!1}),s.addEventListener("beforeinput",n=>{if(a("beforeinput",{observing:d,e:n}),!d&&!n.isComposing&&n.data){const f=n.data,u=b({input:f,patterns:i});f&&f===u&&(M(),I(f))}}),s.addEventListener("keyup",n=>{if(a("keyup",n.code,{observing:d,e:n}),n.code==="Enter"){let f=!1;t.clearOnInputEmpty&&s.value===""&&(f=!0,j(),I("")),c===1&&w(f)}n.code==="Backspace"&&a("backspace",{outputTiming:c},s.value)}),t.realtime instanceof HTMLInputElement&&t.realtime.addEventListener("change",()=>{a("realtime change"),K(),w()}),t.enter instanceof HTMLInputElement&&t.enter.addEventListener("change",()=>{a("enter change"),K()})}l.CaptureableCharacterType=k,l.KanaType=N,l.OutputTiming=Y,l.setupObserver=$,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map

(function(E,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(E=typeof globalThis<"u"?globalThis:E||self,g(E.KanaCapture={}))})(this,function(E){"use strict";function g(e,f){if(!e.length)return{before:e,after:f,diff:f,same:"",gap:0};if(e===f)return{before:e,after:f,diff:"",same:e,gap:0};const t=e.split(""),i=f.split(""),l=Math.max(t.length,i.length),o=[],s=[];let u=0;for(let A=0;A<l;A++){const d=t[A];for(let a=A+u;a<l;a++,u++){const N=i[a];if(d===N){o.push(d);break}s.push(N)}}return{before:e,after:f,diff:s.join(""),same:o.join(""),gap:u}}var _=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(_||{});const I={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［￥］＾＿“｛｜｝～]/g,11:/[!"#$%&'()*+,-.\/:;<=>?@[\\]^_`{|}~]/g};function M({input:e,patterns:f=0}){const t=[],i=s=>{typeof s=="string"?t.push("["+s+"]"):s instanceof RegExp?t.push(s.source):t.push(I[s].source)};if(Array.isArray(f))for(const s of f)i(s);else i(f);if(t.length===0)return e;const l=new RegExp(t.join("|"),"g"),o=e.replace(l,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function P(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function Z(e){return e+96}const h={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"};var v=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(v||{});function Y(e,f){let t="";for(let i=0;i<f.length;i++){const l=f[i];if(e===0)t+=l;else if(e===1){const o=f.charCodeAt(i);P(o)?t+=String.fromCharCode(Z(o)):t+=l}else e===2&&(typeof h[l]=="string"?t+=h[l]:t+=l)}return t}var O=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(O||{});function j(e,f,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:_.HIRAGANA}){let i=0;function l(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),r=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);i=n||!r?0:1}const o=[];if(typeof f=="string"){const n=document.querySelectorAll(f);for(const r of n)o.push({element:r,type:v.Hiragana})}else for(const n of f)if(typeof n=="string"){const r=document.querySelectorAll(n);for(const m of r)o.push({element:m,type:v.Hiragana})}else o.push({element:n.element,type:n.type??v.Hiragana});let s=!1,u="",A="",d="";const a=new Array(o.length).fill("");function N(){c("reset"),u="",A="",d="";for(let n=0;n<o.length;n++)a[n]=""}function k(){u=e.value,o.forEach(({element:n},r)=>{a[r]=n.value}),c("setup",e.value,{defaultString:u,activeOutputs:o})}let K;function w(){c("start",{timer:K}),!K&&(K=setInterval(()=>{l(),G()},t.observeInterval??30))}function R(){c("end",{timer:K}),K&&(clearInterval(K),K=void 0)}function G(){let n=e.value;c("observe",{compositing:s,inputString:n,defaultString:u,currentString:A,outputValues:a}),!(n===""||(n=g(u,n).diff,A===n))&&(A=n,s&&H(A))}function H(n){c("set",{defaultString:u,string:n,inputValue:d,outputValues:a});const r=M({input:n,patterns:t.captureablePatterns??_.HIRAGANA});console.warn({extracted:r,string:n,inputValue:d,defaultString:u}),r.length===n.length&&(d=r),o.forEach(({element:m,type:B},U)=>{const L=Y(B,d);c("converted",{type:B,string:n,inputValue:d,after:L,before:a[U]}),i===0?m.value=a[U]+L:i===1&&(m.dataset.kana=a[U]=L)})}function S(){o.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function c(n,...r){if(t.debug){if(r.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...r)}}e.addEventListener("focus",()=>{c("focus"),k()}),e.addEventListener("blur",()=>{c("blur"),R()}),e.addEventListener("compositionstart",n=>{c("compositionstart",{e:n}),k(),w(),s=!0}),e.addEventListener("compositionend",n=>{c("compositionend",{e:n}),R(),H(d),N(),s=!1}),e.addEventListener("keydown",n=>{c("keydown",{compositing:s,e:n}),s||k(),n.code==="Enter"&&(t.clearOnInputEmpty&&e.value===""?(N(),H("")):i===1&&S())}),e.addEventListener("keyup",n=>{c("keyup",{compositing:s,e:n})})}E.CaptureableCharacterType=_,E.KanaType=v,E.OutputMode=O,E.setupObserver=j,Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

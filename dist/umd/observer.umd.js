(function(A,_){typeof exports=="object"&&typeof module<"u"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(A=typeof globalThis<"u"?globalThis:A||self,_(A.KanaCapture={}))})(this,function(A){"use strict";function _(e,f){if(!e.length||!f.length)return{before:e,after:f,diff:f,same:"",gap:0};if(e===f)return{before:e,after:f,diff:"",same:e,gap:0};const t=e.split(""),s=f.split(""),o=Math.max(t.length,s.length),c=[],H=[];let i=0;for(let E=0;E<o;E++){const l=t[E];for(let a=E+i;a<o;a++,i++){const d=s[a];if(l===d){c.push(l);break}H.push(d)}}return{before:e,after:f,diff:H.join(""),same:c.join(""),gap:i}}var N=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(N||{});const Y={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［￥］＾＿“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function w({input:e,patterns:f=0}){const t=f instanceof RegExp?f:I(f),s=e.replace(t,"");return s.length===0?e:e.replace(new RegExp("["+s+"]","g"),"")}function I(e){const f=[],t=s=>{typeof s=="string"?f.push("["+s+"]"):s instanceof RegExp?f.push(s.source):f.push(Y[s].source)};if(Array.isArray(e))for(const s of e)t(s);else t(e);return new RegExp(f.join("|"),"g")}function j(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function x(e){return e+96}const M={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"};var m=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(m||{});function G(e,f){let t="";for(let s=0;s<f.length;s++){const o=f[s];if(e===0)t+=o;else if(e===1){const c=f.charCodeAt(s);j(c)?t+=String.fromCharCode(x(c)):t+=o}else e===2&&(typeof M[o]=="string"?t+=M[o]:t+=o)}return t}var O=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(O||{});function S(e,f,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:N.HIRAGANA}){const s=I(t.captureablePatterns??N.HIRAGANA),o=typeof e=="string"?document.querySelector(e):e;if(!o)throw new Error("input element not found");let c=0;function H(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),u=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);c=n||!u?0:1}const i=[],E=n=>{if(typeof n=="string"){const u=document.querySelectorAll(n);for(const k of u)i.push({element:k,type:m.Hiragana})}else n instanceof HTMLInputElement?i.push({element:n,type:m.Hiragana}):i.push({element:n.element,type:n.type??m.Hiragana})};if(Array.isArray(f))for(const n of f)E(n);else E(f);let l=!1,a="",d="",v="";const K=new Array(i.length).fill("");function B(){r("reset"),a="",d="",v="";for(let n=0;n<i.length;n++)K[n]=""}function U(){a=o.value,i.forEach(({element:n},u)=>{K[u]=n.value}),r("setup",o.value,{defaultString:a,activeOutputs:i})}let g;function b(){r("start",{timer:g}),!g&&(g=setInterval(()=>{H(),q()},t.observeInterval??30))}function P(){r("end",{timer:g}),g&&(clearInterval(g),g=void 0)}function q(){let n=o.value;r("observe",{observing:l,inputString:n,defaultString:a,currentString:d,outputValues:K}),!(n===""||(n=_(a,n).diff,d===n))&&(d=n,l&&L(d))}function L(n){r("set",{defaultString:a,string:n,inputValue:v,outputValues:K});const u=w({input:n,patterns:s});u.length===n.length&&(v=u),i.forEach(({element:k,type:Z},R)=>{const h=G(Z,v);r("converted",{type:Z,string:n,inputValue:v,after:h,before:K[R]}),c===0?k.value=K[R]+h:c===1&&(k.dataset.kana=K[R]=h)})}function V(){i.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function r(n,...u){if(t.debug){if(u.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...u)}}o.addEventListener("focus",()=>{r("focus"),U()}),o.addEventListener("blur",()=>{r("blur"),P()}),o.addEventListener("compositionstart",n=>{r("compositionstart",{e:n}),U(),b(),l=!0}),o.addEventListener("compositionend",n=>{r("compositionend",{e:n}),P(),L(v),B(),l=!1}),o.addEventListener("keydown",n=>{r("keydown",{observing:l,e:n}),l||U(),n.code==="Enter"&&(t.clearOnInputEmpty&&o.value===""?(B(),L("")):c===1&&V())}),o.addEventListener("keyup",n=>{r("keyup",{observing:l,e:n})})}A.CaptureableCharacterType=N,A.KanaType=m,A.OutputTiming=O,A.setupObserver=S,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

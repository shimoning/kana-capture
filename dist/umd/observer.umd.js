(function(c,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(c=typeof globalThis<"u"?globalThis:c||self,l(c.KanaCapture={}))})(this,function(c){"use strict";var l=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.ZENKAKU_SPACE=3]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=4]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=5]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=6]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=7]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=8]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=9]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=10]="HANKAKU_1BYTE_SYMBOL",e))(l||{});const M={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[　]/g,4:/[ ]/g,5:/[Ａ-Ｚａ-ｚ]/g,6:/[A-Za-z]/g,7:/[０-９]/g,8:/[0-9]/g,9:/[！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［￥］＾＿“｛｜｝～]/g,10:/[!"#$%&'()*+,-.\/:;<=>?@[\\]^_`{|}~]/g};function O({input:e,patterns:s=0}){const t=[],r=f=>{typeof f=="string"?t.push("["+f+"]"):f instanceof RegExp?t.push(f.source):t.push(M[f].source)};if(Array.isArray(s))for(const f of s)r(f);else r(s);if(t.length===0)return e;const g=new RegExp(t.join("|"),"g"),o=e.replace(g,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function I(e){return e>=12353&&e<=12435||e==12445||e==12446}function P(e){return e+96}const m={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"};var K=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(K||{});function Z(e,s){let t="";for(let r=0;r<s.length;r++){const g=s.charCodeAt(r);if(!I(g)){t+=s[r];continue}if(e===0)t+=s[r];else if(e===1)t+=String.fromCharCode(P(g));else if(e===2){const o=s[r];typeof m[o]=="string"&&(t+=m[o])}}return t}var L=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(L||{});function Y(e,s,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:l.HIRAGANA}){let r=0;function g(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),i=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);r=n||!i?0:1}const o=[];if(typeof s=="string"){const n=document.querySelectorAll(s);for(const i of n)o.push({element:i,type:K.Hiragana})}else for(const n of s)if(typeof n=="string"){const i=document.querySelectorAll(n);for(const N of i)o.push({element:N,type:K.Hiragana})}else o.push({element:n.element,type:n.type??K.Hiragana});let f=!1,A="",v="",E="";const d=new Array(o.length).fill("");function S(){u("reset"),A="",v="",E="";for(let n=0;n<o.length;n++)d[n]=""}function _(){A=e.value,o.forEach(({element:n},i)=>{d[i]=n.value}),u("setup",e.value,{defaultString:A,activeOutputs:o})}let a;function w(){u("start",{timer:a}),!a&&(a=setInterval(()=>{g(),h()},t.observeInterval??30))}function B(){u("end",{timer:a}),a&&(clearInterval(a),a=void 0)}function h(){let n=e.value;u("observe",{compositing:f,inputString:n,defaultString:A,currentString:v,outputValues:d}),n!==""&&(n=n.replace(new RegExp("["+A+"]","g"),""),v!==n&&(v=n,f&&H(v)))}function H(n){u("set",{defaultString:A,string:n,inputValue:E,outputValues:d});const i=O({input:n,patterns:t.captureablePatterns??l.HIRAGANA});console.warn({extracted:i,string:n,inputValue:E,defaultString:A}),i.length===n.length&&(E=i),o.forEach(({element:N,type:R},k)=>{const U=Z(R,E);u("converted",{type:R,string:n,inputValue:E,after:U,before:d[k]}),r===0?N.value=d[k]+U:r===1&&(N.dataset.kana=d[k]=U)})}function x(){o.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function u(n,...i){if(t.debug){if(i.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...i)}}e.addEventListener("focus",()=>{u("focus"),_()}),e.addEventListener("blur",()=>{u("blur"),B()}),e.addEventListener("compositionstart",n=>{u("compositionstart",{e:n}),_(),w(),f=!0}),e.addEventListener("compositionend",n=>{u("compositionend",{e:n}),B(),H(E),S(),f=!1}),e.addEventListener("keydown",n=>{u("keydown",{compositing:f,e:n}),f||_(),n.code==="Enter"&&(t.clearOnInputEmpty&&e.value===""?(S(),H("")):r===1&&x())}),e.addEventListener("keyup",n=>{u("keyup",{compositing:f,e:n})})}c.CaptureableCharacterType=l,c.KanaType=K,c.OutputMode=L,c.setupObserver=Y,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

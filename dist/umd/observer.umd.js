(function(d,_){typeof exports=="object"&&typeof module<"u"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(d=typeof globalThis<"u"?globalThis:d||self,_(d.KanaCapture={}))})(this,function(d){"use strict";function _(e,f){if(!e.length||!f.length)return{before:e,after:f,diff:f,same:"",gap:0};if(e===f)return{before:e,after:f,diff:"",same:e,gap:0};const t=e.split(""),o=f.split(""),s=Math.max(t.length,o.length),l=[],k=[];let r=0;for(let E=0;E<s;E++){const u=t[E];for(let a=E+r;a<s;a++,r++){const A=o[a];if(u===A){l.push(u);break}k.push(A)}}return{before:e,after:f,diff:k.join(""),same:l.join(""),gap:r}}var H=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(H||{});const G={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂”＃＄％＆＇’（）＊＋，－．／：；＜＝＞？＠［￥］＾＿｀“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function R({input:e,patterns:f=0}){const t=f instanceof RegExp?f:I(f),o=e.replace(t,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function I(e){const f=[],t=o=>{typeof o=="string"?f.push("["+o+"]"):o instanceof RegExp?f.push(o.source):f.push(G[o].source)};if(Array.isArray(e))for(const o of e)t(o);else t(e);return new RegExp(f.join("|"),"g")}function b(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function S(e){return e+96}const O={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"},B={Ａ:"A",Ｂ:"B",Ｃ:"C",Ｄ:"D",Ｅ:"E",Ｆ:"F",Ｇ:"G",Ｈ:"H",Ｉ:"I",Ｊ:"J",Ｋ:"K",Ｌ:"L",Ｍ:"M",Ｎ:"N",Ｏ:"O",Ｐ:"P",Ｑ:"Q",Ｒ:"R",Ｓ:"S",Ｔ:"T",Ｕ:"U",Ｖ:"V",Ｗ:"W",Ｘ:"X",Ｙ:"Y",Ｚ:"Z",ａ:"a",ｂ:"b",ｃ:"c",ｄ:"d",ｅ:"e",ｆ:"f",ｇ:"g",ｈ:"h",ｉ:"i",ｊ:"j",ｋ:"k",ｌ:"l",ｍ:"m",ｎ:"n",ｏ:"o",ｐ:"p",ｑ:"q",ｒ:"r",ｓ:"s",ｔ:"t",ｕ:"u",ｖ:"v",ｗ:"w",ｘ:"x",ｙ:"y",ｚ:"z"},P={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"},Z={"　":" ","！":"!","＂":'"',"”":'"',"＃":"#","＄":"$","％":"%","＆":"&","＇":"'","’":"'","（":"(","）":")","＊":"*","＋":"+","，":",","－":"-","．":".","／":"/","：":":","；":";","＜":"<","＝":"=","＞":">","？":"?","＠":"@","［":"[","￥":"\\","］":"]","＾":"^","＿":"_","｀":"`","“":"`","｛":"{","｜":"|","｝":"}","～":"~"};var N=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(N||{});function q(e,f){let t="";for(let o=0;o<f.length;o++){const s=f[o];if(e===0)t+=s;else if(e===1){const l=f.charCodeAt(o);b(l)?t+=String.fromCharCode(S(l)):t+=s}else e===2&&(typeof O[s]=="string"?t+=O[s]:typeof B[s]=="string"?t+=B[s]:typeof P[s]=="string"?t+=P[s]:typeof Z[s]=="string"?t+=Z[s]:t+=s)}return t}var Y=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(Y||{});function V(e,f,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:H.HIRAGANA}){const o=I(t.captureablePatterns??H.HIRAGANA),s=typeof e=="string"?document.querySelector(e):e;if(!s)throw new Error("input element not found");let l=0;function k(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),i=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);l=n||!i?0:1}const r=[],E=n=>{if(typeof n=="string"){const i=document.querySelectorAll(n);for(const m of i)r.push({element:m,type:N.Hiragana})}else n instanceof HTMLInputElement?r.push({element:n,type:N.Hiragana}):r.push({element:n.element,type:n.type??N.Hiragana})};if(Array.isArray(f))for(const n of f)E(n);else E(f);let u=!1,a="",A="",v="";const g=new Array(r.length).fill("");function w(){c("reset"),a="",A="",v="";for(let n=0;n<r.length;n++)g[n]=""}function M(){a=s.value,r.forEach(({element:n},i)=>{g[i]=n.value}),c("setup",s.value,{defaultString:a,activeOutputs:r})}let K;function z(){c("start",{timer:K}),!K&&(K=setInterval(()=>{k(),$()},t.observeInterval??30))}function x(){c("end",{timer:K}),K&&(clearInterval(K),K=void 0)}function $(){const n=s.value;if(c("observe",{observing:u,inputString:n,defaultString:a,currentString:A,outputValues:g}),n==="")return;const i=_(a,n);A!==i.diff&&(A=i.diff,u&&U(A))}function U(n){c("set",{defaultString:a,string:n,inputValue:v,outputValues:g});const i=R({input:n,patterns:o});i.length===n.length&&(v=i),r.forEach(({element:m,type:j},h)=>{const L=q(j,v);c("converted",{type:j,string:n,inputValue:v,after:L,before:g[h]}),l===0?m.value=g[h]+L:l===1&&(m.dataset.kana=g[h]=L)})}function y(){r.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function c(n,...i){if(t.debug){if(i.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...i)}}s.addEventListener("focus",()=>{c("focus"),M()}),s.addEventListener("blur",()=>{c("blur"),x()}),s.addEventListener("compositionstart",n=>{c("compositionstart",{e:n}),M(),z(),u=!0}),s.addEventListener("compositionend",n=>{c("compositionend",{e:n}),x(),U(v),w(),u=!1}),s.addEventListener("keydown",n=>{c("keydown",{observing:u,e:n})}),s.addEventListener("keyup",n=>{if(c("keyup",{observing:u,e:n}),n.code==="Enter")t.clearOnInputEmpty&&s.value===""?(w(),U("")):l===1&&y();else if(!u){const i=s.value.slice(-1),m=R({input:i,patterns:o});i===m&&(M(),U(i))}})}d.CaptureableCharacterType=H,d.KanaType=N,d.OutputTiming=Y,d.setupObserver=V,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

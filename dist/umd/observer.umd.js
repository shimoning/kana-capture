(function(f,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(f=typeof globalThis<"u"?globalThis:f||self,v(f.KanaCapture={}))})(this,function(f){"use strict";function v(t){return t>=12353&&t<=12435||t==12445||t==12446}const p={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"};var g=(t=>(t[t.Hiragana=0]="Hiragana",t[t.ZenkakuKatakana=1]="ZenkakuKatakana",t[t.HankakuKatakana=2]="HankakuKatakana",t))(g||{});function C(t,u){let n="";for(let o=0;o<u.length;o++){const E=u.charCodeAt(o);if(v(E)){if(t===0)n+=u[o];else if(t===1)n+=String.fromCharCode(E+96);else if(t===2){const i=u[o];typeof p[i]=="string"&&(n+=p[i])}}}return n}var I=(t=>(t[t.REALTIME=0]="REALTIME",t[t.ENTER=1]="ENTER",t))(I||{});const L=/[^ 　ぁあ-んー]/g,S=/[ぁぃぅぇぉっゃゅょ]/g;function M(t,u,n={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1}){let o=0;function E(){const e=n.realtime&&(n.realtime===!0||n.realtime instanceof HTMLInputElement&&n.realtime.checked),a=n.enter&&(n.enter===!0||n.enter instanceof HTMLInputElement&&n.enter.checked);o=e||!a?0:1}const i=[];if(typeof u=="string"){const e=document.querySelectorAll(u);for(const a of e)i.push({element:a,type:g.Hiragana})}else for(const e of u)if(typeof e=="string"){const a=document.querySelectorAll(e);for(const b of a)i.push({element:b,type:g.Hiragana})}else i.push({element:e.element,type:e.type??g.Hiragana});let l=!1,c="",k="",m="";const s=new Array(i.length).fill("");function O(){r("reset"),c="",k="",m="";for(let e=0;e<i.length;e++)s[e]=""}function h(){c=t.value,i.forEach(({element:e},a)=>{s[a]=e.value}),r("setup",t.value,{defaultString:c,activeOutputs:i})}let d;function P(){r("start",{timer:d}),!d&&(d=setInterval(()=>{E(),T()},n.observeInterval??30))}function A(){r("end"),d&&(clearInterval(d),d=void 0)}function T(){let e=t.value;if(r("observe",{compositing:l,inputString:e,defaultString:c,currentString:k,outputValues:s}),e===""||(e.indexOf(c)!==-1&&(e=e.replace(c,"")),k===e)||(k=e,!l))return;const a=k.replace(L,"");_(a)}function _(e){r("set",{defaultString:c,hiraganaString:e,inputValue:m,outputValues:s}),e.length&&(m=e),i.forEach(({element:a,type:b},H)=>{const y=C(b,m);r("converted",{type:b,inputValue:m,after:y,before:s[H]}),o===0?a.value=s[H]+y:o===1&&(a.dataset.kana=s[H]=y)})}function R(){i.forEach(({element:e})=>{e.dataset.kana&&(e.value+=e.dataset.kana,e.removeAttribute("data-kana"))})}function r(e,...a){if(n.debug){if(a.length===0){console.info("debug",{message:e});return}console.info("debug",{message:e},...a)}}t.addEventListener("focus",()=>{r("focus"),h()}),t.addEventListener("blur",()=>{r("blur"),A()}),t.addEventListener("compositionstart",e=>{r("compositionstart",{e}),h(),P(),l=!0}),t.addEventListener("compositionend",e=>{r("compositionend",{e}),A(),l=!1}),t.addEventListener("keydown",e=>{r("keydown",{compositing:l,e}),l||h(),e.code==="Enter"&&(n.clearOnInputEmpty&&t.value===""?(O(),_("")):o===1&&R())}),t.addEventListener("keyup",e=>{r("keyup",{compositing:l,e})})}f.AntiHiraganaPattern=L,f.CompactHiraganaPattern=S,f.KanaType=g,f.OutputMode=I,f.kanaConverter=C,f.setupObserver=M,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

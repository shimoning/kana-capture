(function(a,_){typeof exports=="object"&&typeof module<"u"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(a=typeof globalThis<"u"?globalThis:a||self,_(a.KanaCapture={}))})(this,function(a){"use strict";function _(e,s){if(!e.length||!s.length)return{before:e,after:s,diff:s,same:"",gap:0};if(e===s)return{before:e,after:s,diff:"",same:e,gap:0};const t=e.split(""),o=s.split(""),i=Math.max(t.length,o.length),A=[],r=[];let d=0;for(let K=0;K<i;K++){const l=t[K];for(let v=K+d;v<i;v++,d++){const u=o[v];if(l===u){A.push(l);break}r.push(u)}}return{before:e,after:s,diff:r.join(""),same:A.join(""),gap:d}}var M=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(M||{});const G={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂”＃＄％＆＇’（）＊＋，－．／：；＜＝＞？＠［￥］＾＿｀“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function b({input:e,patterns:s=0}){const t=s instanceof RegExp?s:O(s),o=e.replace(t,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function O(e){const s=[],t=o=>{typeof o=="string"?s.push("["+o+"]"):o instanceof RegExp?s.push(o.source):s.push(G[o].source)};if(Array.isArray(e))for(const o of e)t(o);else t(e);return new RegExp(s.join("|"),"g")}function q(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function V(e){return e+96}const B={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"},P={Ａ:"A",Ｂ:"B",Ｃ:"C",Ｄ:"D",Ｅ:"E",Ｆ:"F",Ｇ:"G",Ｈ:"H",Ｉ:"I",Ｊ:"J",Ｋ:"K",Ｌ:"L",Ｍ:"M",Ｎ:"N",Ｏ:"O",Ｐ:"P",Ｑ:"Q",Ｒ:"R",Ｓ:"S",Ｔ:"T",Ｕ:"U",Ｖ:"V",Ｗ:"W",Ｘ:"X",Ｙ:"Y",Ｚ:"Z",ａ:"a",ｂ:"b",ｃ:"c",ｄ:"d",ｅ:"e",ｆ:"f",ｇ:"g",ｈ:"h",ｉ:"i",ｊ:"j",ｋ:"k",ｌ:"l",ｍ:"m",ｎ:"n",ｏ:"o",ｐ:"p",ｑ:"q",ｒ:"r",ｓ:"s",ｔ:"t",ｕ:"u",ｖ:"v",ｗ:"w",ｘ:"x",ｙ:"y",ｚ:"z"},Z={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"},w={"　":" ","！":"!","＂":'"',"”":'"',"＃":"#","＄":"$","％":"%","＆":"&","＇":"'","’":"'","（":"(","）":")","＊":"*","＋":"+","，":",","－":"-","．":".","／":"/","：":":","；":";","＜":"<","＝":"=","＞":">","？":"?","＠":"@","［":"[","￥":"\\","］":"]","＾":"^","＿":"_","｀":"`","“":"`","｛":"{","｜":"|","｝":"}","～":"~"};var H=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(H||{});function z(e,s){let t="";for(let o=0;o<s.length;o++){const i=s[o];if(e===0)t+=i;else if(e===1){const A=s.charCodeAt(o);q(A)?t+=String.fromCharCode(V(A)):t+=i}else e===2&&(typeof B[i]=="string"?t+=B[i]:typeof P[i]=="string"?t+=P[i]:typeof Z[i]=="string"?t+=Z[i]:typeof w[i]=="string"?t+=w[i]:t+=i)}return t}var S=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(S||{});function $(e,s,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:M.HIRAGANA}){const o=O(t.captureablePatterns??M.HIRAGANA),i=o.source.includes("　"),A=o.source.includes(" "),r=typeof e=="string"?document.querySelector(e):e;if(!r)throw new Error("input element not found");let d=0;function K(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),f=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);d=n||!f?0:1}const l=[],v=n=>{if(typeof n=="string"){const f=document.querySelectorAll(n);for(const L of f)l.push({element:L,type:H.Hiragana})}else n instanceof HTMLInputElement?l.push({element:n,type:H.Hiragana}):l.push({element:n.element,type:n.type??H.Hiragana})};if(Array.isArray(s))for(const n of s)v(n);else v(s);let u=!1,k="",N="",m="";const E=new Array(l.length).fill("");function Y(){c("reset"),k="",N="",m="";for(let n=0;n<l.length;n++)E[n]=""}function h(){k=r.value,l.forEach(({element:n},f)=>{E[f]=n.value}),c("setup",r.value,{defaultString:k,activeOutputs:l})}let g;function y(){c("start",{timer:g}),!g&&(g=setInterval(()=>{K(),D()},t.observeInterval??30))}function j(){c("end",{timer:g}),g&&(clearInterval(g),g=void 0)}function D(){const n=r.value;if(c("observe",{observing:u,inputString:n,defaultString:k,currentString:N,outputValues:E}),n==="")return;const f=_(k,n);N!==f.diff&&(N=f.diff,u&&U(N))}function U(n){c("set",{defaultString:k,string:n,inputValue:m,outputValues:E});const f=b({input:n,patterns:o});f.length===n.length&&(m=f),l.forEach(({element:L,type:x},R)=>{const I=z(x,m);c("converted",{type:x,string:n,inputValue:m,after:I,before:E[R]}),d===0?L.value=E[R]+I:d===1&&(L.dataset.kana=E[R]=I)})}function F(){l.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function c(n,...f){if(t.debug){if(f.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...f)}}r.addEventListener("focus",()=>{c("focus"),h()}),r.addEventListener("blur",()=>{c("blur"),j()}),r.addEventListener("compositionstart",n=>{c("compositionstart",{e:n}),h(),y(),u=!0}),r.addEventListener("compositionend",n=>{c("compositionend",{e:n}),j(),U(m),Y(),u=!1}),r.addEventListener("keydown",n=>{c("keydown",{observing:u,e:n})}),r.addEventListener("keyup",n=>{if(c("keyup",{observing:u,e:n}),n.code==="Enter")t.clearOnInputEmpty&&r.value===""?(Y(),U("")):d===1&&F();else if(!u&&n.code==="Space"){const f=r.value.slice(-1);(i&&f==="　"||A&&f===" ")&&(h(),U(f))}})}a.CaptureableCharacterType=M,a.KanaType=H,a.OutputTiming=S,a.setupObserver=$,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

(function(d,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(d=typeof globalThis<"u"?globalThis:d||self,v(d.KanaCapture={}))})(this,function(d){"use strict";function v(e,f){if(!e.length||!f.length)return{before:e,after:f,diff:f,same:"",gap:0};if(e===f)return{before:e,after:f,diff:"",same:e,gap:0};const t=e.split(""),o=f.split(""),i=Math.max(t.length,o.length),K=[],c=[];let u=0;for(let l=0;l<i;l++){const E=t[l];for(let a=l+u;a<i;a++,u++){const A=o[a];if(E===A){K.push(E);break}c.push(A)}}return{before:e,after:f,diff:c.join(""),same:K.join(""),gap:u}}var N=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(N||{});const P={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［￥］＾＿“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function Z({input:e,patterns:f=0}){const t=f instanceof RegExp?f:L(f),o=e.replace(t,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function L(e){const f=[],t=o=>{typeof o=="string"?f.push("["+o+"]"):o instanceof RegExp?f.push(o.source):f.push(P[o].source)};if(Array.isArray(e))for(const o of e)t(o);else t(e);return new RegExp(f.join("|"),"g")}function Y(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function j(e){return e+96}const h={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"};var _=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(_||{});function x(e,f){let t="";for(let o=0;o<f.length;o++){const i=f[o];if(e===0)t+=i;else if(e===1){const K=f.charCodeAt(o);Y(K)?t+=String.fromCharCode(j(K)):t+=i}else e===2&&(typeof h[i]=="string"?t+=h[i]:t+=i)}return t}var O=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(O||{});function G(e,f,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:N.HIRAGANA}){const o=L(t.captureablePatterns??N.HIRAGANA);let i=0;function K(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),s=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);i=n||!s?0:1}const c=[];if(typeof f=="string"){const n=document.querySelectorAll(f);for(const s of n)c.push({element:s,type:_.Hiragana})}else for(const n of f)if(typeof n=="string"){const s=document.querySelectorAll(n);for(const k of s)c.push({element:k,type:_.Hiragana})}else c.push({element:n.element,type:n.type??_.Hiragana});let u=!1,l="",E="",a="";const A=new Array(c.length).fill("");function B(){r("reset"),l="",E="",a="";for(let n=0;n<c.length;n++)A[n]=""}function m(){l=e.value,c.forEach(({element:n},s)=>{A[s]=n.value}),r("setup",e.value,{defaultString:l,activeOutputs:c})}let g;function w(){r("start",{timer:g}),!g&&(g=setInterval(()=>{K(),S()},t.observeInterval??30))}function I(){r("end",{timer:g}),g&&(clearInterval(g),g=void 0)}function S(){let n=e.value;r("observe",{observing:u,inputString:n,defaultString:l,currentString:E,outputValues:A}),!(n===""||(n=v(l,n).diff,E===n))&&(E=n,u&&H(E))}function H(n){r("set",{defaultString:l,string:n,inputValue:a,outputValues:A});const s=Z({input:n,patterns:o});s.length===n.length&&(a=s),c.forEach(({element:k,type:M},U)=>{const R=x(M,a);r("converted",{type:M,string:n,inputValue:a,after:R,before:A[U]}),i===0?k.value=A[U]+R:i===1&&(k.dataset.kana=A[U]=R)})}function b(){c.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function r(n,...s){if(t.debug){if(s.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...s)}}e.addEventListener("focus",()=>{r("focus"),m()}),e.addEventListener("blur",()=>{r("blur"),I()}),e.addEventListener("compositionstart",n=>{r("compositionstart",{e:n}),m(),w(),u=!0}),e.addEventListener("compositionend",n=>{r("compositionend",{e:n}),I(),H(a),B(),u=!1}),e.addEventListener("keydown",n=>{r("keydown",{observing:u,e:n}),u||m(),n.code==="Enter"&&(t.clearOnInputEmpty&&e.value===""?(B(),H("")):i===1&&b())}),e.addEventListener("keyup",n=>{r("keyup",{observing:u,e:n})})}d.CaptureableCharacterType=N,d.KanaType=_,d.OutputTiming=O,d.setupObserver=G,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

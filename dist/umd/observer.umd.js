(function(A,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(A=typeof globalThis<"u"?globalThis:A||self,m(A.KanaCapture={}))})(this,function(A){"use strict";function m(e,s){if(!e.length||!s.length)return{before:e,after:s,diff:s,same:"",gap:0};if(e===s)return{before:e,after:s,diff:"",same:e,gap:0};const t=e.split(""),o=s.split(""),f=Math.max(t.length,o.length),l=[],H=[];let i=0;for(let E=0;E<f;E++){const u=t[E];for(let a=E+i;a<f;a++,i++){const d=o[a];if(u===d){l.push(u);break}H.push(d)}}return{before:e,after:s,diff:H.join(""),same:l.join(""),gap:i}}var N=(e=>(e[e.HIRAGANA=0]="HIRAGANA",e[e.KUTOUTEN=1]="KUTOUTEN",e[e.CHOUON=2]="CHOUON",e[e.KAGIKAKKO=3]="KAGIKAKKO",e[e.ZENKAKU_SPACE=4]="ZENKAKU_SPACE",e[e.HANKAKU_SPACE=5]="HANKAKU_SPACE",e[e.ZENKAKU_ALPHABET=6]="ZENKAKU_ALPHABET",e[e.HANKAKU_ALPHABET=7]="HANKAKU_ALPHABET",e[e.ZENKAKU_NUMBER=8]="ZENKAKU_NUMBER",e[e.HANKAKU_NUMBER=9]="HANKAKU_NUMBER",e[e.ZENKAKU_1BYTE_SYMBOL=10]="ZENKAKU_1BYTE_SYMBOL",e[e.HANKAKU_1BYTE_SYMBOL=11]="HANKAKU_1BYTE_SYMBOL",e))(N||{});const x={0:/[ぁ-ん]/g,1:/[、。]/g,2:/[ー]/g,3:/[「」]/g,4:/[　]/g,5:/[ ]/g,6:/[Ａ-Ｚａ-ｚ]/g,7:/[A-Za-z]/g,8:/[０-９]/g,9:/[0-9]/g,10:/[！＂”＃＄％＆＇’（）＊＋，－．／：；＜＝＞？＠［￥］＾＿“｛｜｝～]/g,11:/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g};function G({input:e,patterns:s=0}){const t=s instanceof RegExp?s:R(s),o=e.replace(t,"");return o.length===0?e:e.replace(new RegExp("["+o+"]","g"),"")}function R(e){const s=[],t=o=>{typeof o=="string"?s.push("["+o+"]"):o instanceof RegExp?s.push(o.source):s.push(x[o].source)};if(Array.isArray(e))for(const o of e)t(o);else t(e);return new RegExp(s.join("|"),"g")}function b(e){return e>=12353&&e<=12438||e>=12445&&e<=12446}function S(e){return e+96}const I={が:"ｶﾞ",ぎ:"ｷﾞ",ぐ:"ｸﾞ",げ:"ｹﾞ",ご:"ｺﾞ",ざ:"ｻﾞ",じ:"ｼﾞ",ず:"ｽﾞ",ぜ:"ｾﾞ",ぞ:"ｿﾞ",だ:"ﾀﾞ",ぢ:"ﾁﾞ",づ:"ﾂﾞ",で:"ﾃﾞ",ど:"ﾄﾞ",ば:"ﾊﾞ",び:"ﾋﾞ",ぶ:"ﾌﾞ",べ:"ﾍﾞ",ぼ:"ﾎﾞ",ぱ:"ﾊﾟ",ぴ:"ﾋﾟ",ぷ:"ﾌﾟ",ぺ:"ﾍﾟ",ぽ:"ﾎﾟ",ゔ:"ｳﾞ",あ:"ｱ",い:"ｲ",う:"ｳ",え:"ｴ",お:"ｵ",か:"ｶ",き:"ｷ",く:"ｸ",け:"ｹ",こ:"ｺ",さ:"ｻ",し:"ｼ",す:"ｽ",せ:"ｾ",そ:"ｿ",た:"ﾀ",ち:"ﾁ",つ:"ﾂ",て:"ﾃ",と:"ﾄ",な:"ﾅ",に:"ﾆ",ぬ:"ﾇ",ね:"ﾈ",の:"ﾉ",は:"ﾊ",ひ:"ﾋ",ふ:"ﾌ",へ:"ﾍ",ほ:"ﾎ",ま:"ﾏ",み:"ﾐ",む:"ﾑ",め:"ﾒ",も:"ﾓ",や:"ﾔ",ゆ:"ﾕ",よ:"ﾖ",ら:"ﾗ",り:"ﾘ",る:"ﾙ",れ:"ﾚ",ろ:"ﾛ",わ:"ﾜ",を:"ｦ",ん:"ﾝ",ぁ:"ｧ",ぃ:"ｨ",ぅ:"ｩ",ぇ:"ｪ",ぉ:"ｫ",っ:"ｯ",ゃ:"ｬ",ゅ:"ｭ",ょ:"ｮ","。":"｡","、":"､",ー:"ｰ","「":"｢","」":"｣","・":"･"},O={Ａ:"A",Ｂ:"B",Ｃ:"C",Ｄ:"D",Ｅ:"E",Ｆ:"F",Ｇ:"G",Ｈ:"H",Ｉ:"I",Ｊ:"J",Ｋ:"K",Ｌ:"L",Ｍ:"M",Ｎ:"N",Ｏ:"O",Ｐ:"P",Ｑ:"Q",Ｒ:"R",Ｓ:"S",Ｔ:"T",Ｕ:"U",Ｖ:"V",Ｗ:"W",Ｘ:"X",Ｙ:"Y",Ｚ:"Z",ａ:"a",ｂ:"b",ｃ:"c",ｄ:"d",ｅ:"e",ｆ:"f",ｇ:"g",ｈ:"h",ｉ:"i",ｊ:"j",ｋ:"k",ｌ:"l",ｍ:"m",ｎ:"n",ｏ:"o",ｐ:"p",ｑ:"q",ｒ:"r",ｓ:"s",ｔ:"t",ｕ:"u",ｖ:"v",ｗ:"w",ｘ:"x",ｙ:"y",ｚ:"z"},B={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"},P={"　":" ","！":"!","＂":'"',"”":'"',"＃":"#","＄":"$","％":"%","＆":"&","＇":"'","’":"'","（":"(","）":")","＊":"*","＋":"+","，":",","－":"-","．":".","／":"/","：":":","；":";","＜":"<","＝":"=","＞":">","？":"?","＠":"@","［":"[","￥":"\\","］":"]","＾":"^","＿":"_","“":"`","｛":"{","｜":"|","｝":"}","～":"~"};var _=(e=>(e[e.Hiragana=0]="Hiragana",e[e.ZenkakuKatakana=1]="ZenkakuKatakana",e[e.HankakuKatakana=2]="HankakuKatakana",e))(_||{});function q(e,s){let t="";for(let o=0;o<s.length;o++){const f=s[o];if(e===0)t+=f;else if(e===1){const l=s.charCodeAt(o);b(l)?t+=String.fromCharCode(S(l)):t+=f}else e===2&&(typeof I[f]=="string"?t+=I[f]:typeof O[f]=="string"?t+=O[f]:typeof B[f]=="string"?t+=B[f]:typeof P[f]=="string"?t+=P[f]:t+=f)}return t}var Z=(e=>(e[e.REALTIME=0]="REALTIME",e[e.ENTER=1]="ENTER",e))(Z||{});function V(e,s,t={observeInterval:30,debug:!1,realtime:!0,enter:!1,clearOnInputEmpty:!1,captureablePatterns:N.HIRAGANA}){const o=R(t.captureablePatterns??N.HIRAGANA),f=typeof e=="string"?document.querySelector(e):e;if(!f)throw new Error("input element not found");let l=0;function H(){const n=t.realtime&&(t.realtime===!0||t.realtime instanceof HTMLInputElement&&t.realtime.checked),c=t.enter&&(t.enter===!0||t.enter instanceof HTMLInputElement&&t.enter.checked);l=n||!c?0:1}const i=[],E=n=>{if(typeof n=="string"){const c=document.querySelectorAll(n);for(const k of c)i.push({element:k,type:_.Hiragana})}else n instanceof HTMLInputElement?i.push({element:n,type:_.Hiragana}):i.push({element:n.element,type:n.type??_.Hiragana})};if(Array.isArray(s))for(const n of s)E(n);else E(s);let u=!1,a="",d="",v="";const g=new Array(i.length).fill("");function Y(){r("reset"),a="",d="",v="";for(let n=0;n<i.length;n++)g[n]=""}function U(){a=f.value,i.forEach(({element:n},c)=>{g[c]=n.value}),r("setup",f.value,{defaultString:a,activeOutputs:i})}let K;function z(){r("start",{timer:K}),!K&&(K=setInterval(()=>{H(),$()},t.observeInterval??30))}function w(){r("end",{timer:K}),K&&(clearInterval(K),K=void 0)}function $(){let n=f.value;r("observe",{observing:u,inputString:n,defaultString:a,currentString:d,outputValues:g}),!(n===""||(n=m(a,n).diff,d===n))&&(d=n,u&&M(d))}function M(n){r("set",{defaultString:a,string:n,inputValue:v,outputValues:g});const c=G({input:n,patterns:o});c.length===n.length&&(v=c),i.forEach(({element:k,type:j},h)=>{const L=q(j,v);r("converted",{type:j,string:n,inputValue:v,after:L,before:g[h]}),l===0?k.value=g[h]+L:l===1&&(k.dataset.kana=g[h]=L)})}function y(){i.forEach(({element:n})=>{n.dataset.kana&&(n.value+=n.dataset.kana,n.removeAttribute("data-kana"))})}function r(n,...c){if(t.debug){if(c.length===0){console.info("debug",{message:n});return}console.info("debug",{message:n},...c)}}f.addEventListener("focus",()=>{r("focus"),U()}),f.addEventListener("blur",()=>{r("blur"),w()}),f.addEventListener("compositionstart",n=>{r("compositionstart",{e:n}),U(),z(),u=!0}),f.addEventListener("compositionend",n=>{r("compositionend",{e:n}),w(),M(v),Y(),u=!1}),f.addEventListener("keydown",n=>{r("keydown",{observing:u,e:n}),u||U(),n.code==="Enter"&&(t.clearOnInputEmpty&&f.value===""?(Y(),M("")):l===1&&y())}),f.addEventListener("keyup",n=>{r("keyup",{observing:u,e:n})})}A.CaptureableCharacterType=N,A.KanaType=_,A.OutputTiming=Z,A.setupObserver=V,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=observer.umd.js.map

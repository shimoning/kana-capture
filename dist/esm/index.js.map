{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import { diff } from './utilities/diff'\nimport {\n  CapturableCharacterPattern,\n  CapturableCharacterType,\n  generateCapturableRegExp,\n  extractor,\n} from './utilities/extractor'\nimport { kanaConverter, KanaType } from './utilities/kanaConverter'\nexport { KanaType, CapturableCharacterType }\nexport type { CapturableCharacterPattern }\n\nexport type Options = {\n  observeInterval?: number; // unit: ms\n  debug?: boolean; // logging if true\n  event?: boolean; // logging if true\n  realtime?: boolean | HTMLInputElement;\n  enter?: boolean | HTMLInputElement;\n  clearOnInputEmpty?: boolean;\n  capturablePatterns?: CapturableCharacterPattern | CapturableCharacterPattern[];\n};\n\n// TODO: support other elements (e.g. HTMLDivElement, HTMLSpanElement, HTMLTextAreaElement)\nexport type OutputElement = Output | HTMLInputElement | string;\nexport type Output = {\n  element: HTMLInputElement;\n  type?: KanaType;\n};\nexport enum OutputTiming {\n  REALTIME, // default and priority\n  ENTER,\n}\n// TODO: support textarea (HTMLTextAreaElement)\nexport type InputElement = HTMLInputElement | string;\nexport function setupObserver(\n  input: InputElement,\n  outputs: OutputElement | OutputElement[],\n  options: Options = {\n    observeInterval: 30,\n    debug: false,\n    realtime: true,\n    enter: false,\n    clearOnInputEmpty: false,\n    capturablePatterns: CapturableCharacterType.HIRAGANA,\n  },\n) {\n  // 入力値を受け付けるパターン\n  // TODO: support dynamic patterns\n  const capturablePatterns = generateCapturableRegExp(\n    options.capturablePatterns ?? CapturableCharacterType.HIRAGANA,\n  )\n\n  // 入力元を整える\n  const inputElement = typeof input === 'string'\n    ? document.querySelector<HTMLInputElement>(input)\n    : input\n  if (!inputElement) {\n    throw new Error('input element not found')\n  }\n\n  // 出力のタイミング\n  let outputTiming = OutputTiming.REALTIME\n  const realtimeIsDynamic = options.realtime instanceof HTMLInputElement\n  const enterIsDynamic = options.enter instanceof HTMLInputElement\n  const outputTimingIsStatic = !realtimeIsDynamic && !enterIsDynamic\n  function _checkOutputTiming() {\n    const realtime =\n      options.realtime &&\n      (options.realtime === true ||\n        (options.realtime instanceof HTMLInputElement && options.realtime.checked))\n    const enter =\n      options.enter &&\n      (options.enter === true ||\n        (options.enter instanceof HTMLInputElement && options.enter.checked))\n    outputTiming = realtime || !enter\n      ? OutputTiming.REALTIME // realtime=true, realtime=false & enter=false\n      : OutputTiming.ENTER  // realtime=false & enter=true\n  }\n  if (outputTimingIsStatic) {\n    _checkOutputTiming()\n  }\n  _debug('outputTiming', { outputTiming, outputTimingIsStatic, realtimeIsDynamic, enterIsDynamic })\n\n  // 出力先を整える\n  const activeOutputs: Required<Output>[] = []\n  const _outputParser = (output: OutputElement): void => {\n    if (typeof output === 'string') {\n      const elements = document.querySelectorAll<HTMLInputElement>(output)\n      for (const element of elements) {\n        activeOutputs.push({ element, type: KanaType.Hiragana })\n      }\n    } else if (output instanceof HTMLInputElement) {\n      activeOutputs.push({ element: output, type: KanaType.Hiragana })\n    } else {\n      activeOutputs.push({\n        element: output.element,\n        type: output.type ?? KanaType.Hiragana,\n      })\n    }\n  }\n  if (Array.isArray(outputs)) {\n    for (const output of outputs) {\n      _outputParser(output)\n    }\n  } else {\n    _outputParser(outputs)\n  }\n\n  // 状態管理\n  let composing: boolean = false\n  let defaultString: string = ''\n  let currentString: string = ''\n\n  let inputValue: string = ''\n  const outputValues: string[] = new Array(activeOutputs.length).fill('')\n  /**\n   * 初期化\n   * @returns void\n   */\n  function _reset() {\n    _debug('reset')\n    defaultString = ''\n    currentString = ''\n\n    inputValue = ''\n    for (let i = 0; i < activeOutputs.length; i++) {\n      outputValues[i] = ''\n    }\n  }\n  /**\n   * 初期入力値を保存する\n   * @returns void\n   */\n  function _setup() {\n    defaultString = inputElement!.value\n    activeOutputs.forEach(({ element }, index) => {\n      outputValues[index] = element.value\n    })\n    _debug('setup', inputElement!.value, { defaultString, activeOutputs })\n  }\n\n  let timer: ReturnType<typeof setInterval> | undefined\n  /**\n   * 監視を開始する\n   * @returns void\n   */\n  function _start() {\n    _debug('start', { timer })\n    if (timer) {\n      return\n    }\n    timer = setInterval(() => {\n      _observe()\n    }, options.observeInterval ?? 30)\n  }\n  /**\n   * 監視を終了する\n   * @returns void\n   */\n  function _end() {\n    _debug('end', { timer })\n    if (timer) {\n      clearInterval(timer)\n      timer = undefined\n    }\n  }\n\n  /**\n   * 入力を監視する\n   * @return void\n   */\n  function _observe() {\n    const inputString = inputElement!.value\n    _debug('observe', { composing, inputString, defaultString, currentString, outputValues })\n\n    // 空文字の場合は何もしない\n    if (inputString === '') {\n      return\n    }\n\n    // すでに入力されている文字を取り除く\n    const diffResult = diff(defaultString, inputString)\n\n    // 同じだったら何もしない\n    if (currentString === diffResult.diff) {\n      return\n    }\n    currentString = diffResult.diff\n\n    // セットする\n    _set(currentString)\n  }\n\n  /**\n   * セットする\n   * @param string string\n   * @returns void\n   */\n  function _set(string: string) {\n    _debug('set', { defaultString, string, inputValue, outputValues })\n    const extracted = extractor({\n      input: string,\n      patterns: capturablePatterns,\n    })\n    if (extracted.length === string.length) {\n      inputValue = extracted\n    }\n\n    activeOutputs.forEach(({ element, type }, index) => {\n      const converted = kanaConverter(type, inputValue)\n      _debug('converted', { type, string, inputValue, after: converted, before: outputValues[index], bufferKana: element.dataset['bufferKana'], bufferOther: element.dataset['bufferOther'] })\n      if (outputTiming === OutputTiming.REALTIME) {\n        element.value = outputValues[index] + converted\n      } else if (outputTiming === OutputTiming.ENTER) {\n        _setBuffer(element, converted)\n      }\n    })\n  }\n\n  /**\n   * 文字を抽出してセットする\n   * @param candidate string\n   * @returns void\n   */\n  function _extractAndSet(candidate: string) {\n    const extracted = extractor({\n      input: candidate,\n      patterns: capturablePatterns,\n    })\n    if (candidate && candidate === extracted) {\n      _setup()\n      _set(extracted)\n    }\n  }\n\n  /**\n   * 文字を反映せずに一時保存する\n   *\n   * @param element HTMLInputElement\n   * @param string  string\n   * @returns void\n   */\n  function _setBuffer(element: HTMLInputElement, string: string) {\n    _debug('set buffer', { composing, element, string })\n    if (composing) {\n      element.dataset['bufferKana'] = string\n    } else {\n      element.dataset['bufferOther'] = (element.dataset['bufferOther'] ?? '') + string\n    }\n  }\n  /**\n   * バッファをクリアする\n   * @param element HTMLInputElement\n   * @returns void\n   */\n  function _clearBuffer(element: HTMLInputElement) {\n    _debug('clear buffer')\n    element.dataset['bufferOther'] = ''\n    element.dataset['bufferKana'] = ''\n  }\n  // 予約\n  // /**\n  //  * 全てのバッファをクリアする\n  //  * @returns void\n  //  */\n  // function _clearBufferAll() {\n  //   activeOutputs.forEach(({ element }) => {\n  //     _clearBuffer(element)\n  //   })\n  // }\n  /**\n   * 反映する\n   * @returns void\n   */\n  function _reflectBufferAll(clear: boolean = false) {\n    activeOutputs.forEach(({ element }) => {\n      if (clear) {\n        element.value = ''\n        _clearBuffer(element)\n        return\n      }\n      const buffer = (element.dataset['bufferOther'] ?? '') + (element.dataset['bufferKana'] ?? '')\n      if (buffer) {\n        element.value += buffer\n        _clearBuffer(element)\n      }\n    })\n  }\n\n  /**\n   * デバッグログ\n   * @param message\n   * @param args\n   * @return void\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function _debug(message: string, ...args: any[]) {\n    if (!options.debug) {\n      return\n    }\n    if (args.length === 0) {\n      console.log('%c[debug]', 'background-color: #ff6d13; color: #fffafa;', { message })\n      return\n    }\n    console.log('%c[debug]', 'background-color: #ff6d13; color: #fffafa;', { message }, ...args)\n  }\n\n  /**\n   * イベントログ\n   * @param message\n   * @param args\n   * @return void\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function _event(message: string, ...args: any[]) {\n    if (!options.event) {\n      return\n    }\n    if (args.length === 0) {\n      console.info('%c[event]', 'background-color: #fffafa; color: #303030;', { message })\n      return\n    }\n    console.info('%c[event]', 'background-color: #fffafa; color: #303030;', { message }, ...args)\n  }\n\n  /**\n   * Event listeners\n   */\n  inputElement.addEventListener('focus', (e: FocusEvent) => {\n    _event('focus', { e })\n    _setup()\n  })\n  inputElement.addEventListener('blur', (e: FocusEvent) => {\n    _event('blur', { e })\n    _end()\n  })\n  inputElement.addEventListener('compositionstart', (e: CompositionEvent) => {\n    _event('compositionstart', { e })\n    _setup()\n    _start()\n    composing = true\n  })\n  inputElement.addEventListener('compositionend', (e: CompositionEvent) => {\n    _event('compositionend', { e, inputValue })\n    _end()\n    _reset()\n    composing = false\n\n    // windows での全角スペース対策\n    if (['　', ' '].includes(e.data)) {\n      _debug('spaces', '\"' + e.data + '\"')\n      _extractAndSet(e.data)\n    }\n  })\n  inputElement.addEventListener('beforeinput', (e: InputEvent) => {\n    _event('beforeinput', { composing, e })\n    if (!composing && !e.isComposing && e.data) {\n      _extractAndSet(e.data)\n    }\n  })\n  inputElement.addEventListener('input', (e: Event) => { // 実際には InputEvent; TS の定義上は Event\n    _event('input', { composing, e })\n  })\n  inputElement.addEventListener('keydown', (e: KeyboardEvent) => {\n    _event('keydown', { composing, e })\n  })\n  inputElement.addEventListener('keyup', (e: KeyboardEvent) => {\n    _event('keyup', { composing, e }, e.code)\n    if (e.code === 'Enter') {\n      let clear = false\n      if (options.clearOnInputEmpty && inputElement.value === '') {\n        clear = true\n        _reset()\n        _set('')\n      }\n      if (outputTiming === OutputTiming.ENTER) {\n        _reflectBufferAll(clear)\n      }\n    }\n    if (e.code === 'Backspace') {\n      // FIXME: REALTIME -> 日本語入力中にバックスペースで全て消すと1文字目が残る\n      // FIXME: ENTER -> 日本語入力中にバックスペースで全て消し、Enterで確定もしくは半角入力後エンターすると1文字目が残る\n      _debug('backspace', { outputTiming }, inputElement.value)\n    }\n  })\n\n  if (options.realtime instanceof HTMLInputElement) {\n    options.realtime.addEventListener('change', () => {\n      _debug('realtime change')\n      _checkOutputTiming()\n      _reflectBufferAll()\n    })\n  }\n  if (options.enter instanceof HTMLInputElement) {\n    options.enter.addEventListener('change', () => {\n      _debug('enter change')\n      _checkOutputTiming()\n    })\n  }\n}\n"],"names":["OutputTiming","OutputTiming2","setupObserver","input","outputs","options","CapturableCharacterType","capturablePatterns","generateCapturableRegExp","inputElement","outputTiming","realtimeIsDynamic","enterIsDynamic","outputTimingIsStatic","_checkOutputTiming","realtime","enter","_debug","activeOutputs","_outputParser","output","elements","element","KanaType","composing","defaultString","currentString","inputValue","outputValues","_reset","i","_setup","index","timer","_start","_observe","_end","inputString","diffResult","diff","_set","string","extracted","extractor","type","converted","kanaConverter","_setBuffer","_extractAndSet","candidate","_clearBuffer","_reflectBufferAll","clear","buffer","message","args","_event"],"mappings":"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"}